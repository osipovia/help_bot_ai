# Правила разработки кода

**Базовый документ:** @vision.md  
**Принцип:** KISS - максимальная простота для MVP

---

## Основные принципы

- **KISS превыше всего** - простота важнее элегантности
- **YAGNI** - не делай то, что может понадобиться
- **Fail Fast** - быстро обнаруживай ошибки, не скрывай их
- **Прямолинейная логика** - минимум абстракций и паттернов

## Технологический стек

Используй только технологии из @vision.md:
- **Python 3.11+**, **aiogram**, **httpx**, **sentence-transformers**, **chromadb**
- **YandexGPT API**, **uv**, **pytest**, **python-dotenv**, **pydantic-settings**

## Структура кода

- **Один файл = одна ответственность** (как в @vision.md раздел 3)
- **Понятные имена** - `telegram_bot_token` вместо `tbt`
- **Модули по функциям** - bot/, llm/, knowledge/, payment/, config/
- **Разделение** - код в src/, данные в data/, логи в logs/

## Типы данных

- **Простые типы** - dict, list, str, int (как в @vision.md раздел 5)
- **JSON для статики** - услуги, конфигурация
- **Память для динамики** - состояние диалогов в dict/list
- **Нет БД** - только файлы и RAM

## Обработка ошибок

- **Логгируй все ошибки** с контекстом (user_id, действие)
- **Fallback на человека** - при сложностях предлагай менеджера
- **Простые сообщения об ошибках** - понятные пользователю

## Конфигурация

- **Один .env файл** - все настройки в одном месте
- **Pydantic валидация** - проверка на старте приложения
- **Понятные имена переменных** - как в @vision.md раздел 10

## Логгирование

- **Структурированные логи** - timestamp, user_id, действие, результат
- **Уровни** - INFO для основных событий, ERROR для ошибок
- **Формат** как в @vision.md раздел 11

## Тестирование

- **Минимум тестов** - только критическая бизнес-логика (платежи, 1С API)
- **pytest** - простые тесты без сложной настройки
- **Мокай внешние API** - YandexGPT, 1С

## Запрещено

- **Сложные паттерны** - Factory, Observer, Strategy и т.д.
- **ORM** - используй простые HTTP-запросы
- **Микросервисы** - только монолит
- **Сложные конфигурации** - никаких YAML, только .env
- **Внешние системы логов** - только файлы

## Команды

```bash
make build       # сборка Docker образа
make run         # запуск бота в контейнере  
make stop        # остановка контейнера
make test        # запуск тестов
make logs        # просмотр логов бота
```

**Docker Compose:**
```bash
docker-compose build     # сборка образа
docker-compose up -d     # запуск в фоне
docker-compose down      # остановка
docker-compose logs -f   # логи с подпиской
```

---

**При сомнениях выбирай самое простое решение. Ссылайся на @vision.md для деталей.** 